(this["webpackJsonpwithdraw-demo"]=this["webpackJsonpwithdraw-demo"]||[]).push([[0],{408:function(e,t,n){},429:function(e,t){},432:function(e,t){},434:function(e,t){},446:function(e,t){},447:function(e,t){},466:function(e,t){},468:function(e,t){},483:function(e,t){},487:function(e,t){},491:function(e,t){},493:function(e,t){},538:function(e,t){},544:function(e,t){},551:function(e,t){},579:function(e,t){},581:function(e,t){},588:function(e,t){},589:function(e,t){},607:function(e,t){},820:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(32),r=n.n(s),c=(n(408),n(409),n(126)),o=n(19),l=n(179),d=n.n(l),p=n(14),h=n(119),u=n(62),b=n.n(u),g=n(178);const x={code_hash:"0x79f90bb5e892d80dd213439eeab551120eb417678824f282b4ffb5f21bad2e1e",hash_type:"type",tx_hash:"0x9154df4f7336402114d04495175b37390ce86a4906d2d4001cf02c3e6d97f39c",index:"0x0",dep_type:"code"},f={script_type_hash:"0x170ef156e9f6132dbca6069dfd3e436f7d91c29d3ac7332c4b33e633b6a299b5",cell_dep:{out_point:{tx_hash:"0xb4b07dcd1571ac18683b515ada40e13b99bd0622197b6817047adc9f407f4828",index:"0x0"},dep_type:"code"}},w={script_type_hash:"0xdeec13a7b8e100579541384ccaf4b5223733e4a5483c3aec95ddc4c1d5ea5b22",cell_dep:{out_point:{tx_hash:"0x2f9f8ec8a1556238aeeefed29e990d53ea75060ef04249371fd8b5246fffb8ea",index:"0x0"},dep_type:"code"}},y={code_hash:"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8",hash_type:"type",tx_hash:"0xf8de3bb47d055cdf460d93a2a6e1b05f7432f9777c8c474abf4eec1d4aee5d37",index:"0x0",dep_type:"dep_group",short_id:0},m={code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",tx_hash:"0xe12877ebd2c3c364dc46c5c992bcfaf4fee33fa13eebdf82c591fc9825aab769",index:"0x0",dep_type:"code"},j="0x4cc2e6526204ae6a2e8fcf12f7ad472f41a1606d5b9624beebd215d780809f6a",_={code_hash:"0x5c365147bb6c40e817a2a53e0dec3661f7390cc77f0c02db138303177b12e9fb",hash_type:"type",args:"0x213743d13048e9f36728c547ab736023a7426e15a3d7d1c82f43ec3b5f266df2"},v=[{symbol:"USDC",name:"USD Coin",decimals:18,tokenURI:"https://cryptologos.cc/logos/usd-coin-usdc-logo.svg?v=002",sudt_script_hash:"",address:"0xca6FcAAA5129aD9e5219397527A17c26E5AD6a6a",issuerLockHash:"0x58bef38794236b315b7c23fd8132d7f42676228d659b291936e8c6c7ba9f064e",l1Lock:{code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",args:"0x58bef38794236b315b7c23fd8132d7f42676228d659b291936e8c6c7ba9f064e"}},{symbol:"ETH",name:"Ethereum",decimals:18,tokenURI:"https://cryptologos.cc/logos/ethereum-eth-logo.svg?v=002",sudt_script_hash:"",address:"0xB1235Dd5bd72d9Ef2F0E311fC5ce7df0583B6458",issuerLockHash:"0x1b072aa0ded384067106ea0c43c85bd71bafa5afdb432123511da46b390a4e33",l1Lock:{code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",args:"0x1b072aa0ded384067106ea0c43c85bd71bafa5afdb432123511da46b390a4e33"}},{symbol:"TAI",name:"NexisDAO TAI",decimals:18,tokenURI:"data:image/png;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAQDAwQDAwQEAwQFBAQFBgoHBgYGBg0JCggKDw0QEA8NDw4RExgUERIXEg4PFRwVFxkZGxsbEBQdHx0aHxgaGxr/2wBDAQQFBQYFBgwHBwwaEQ8RGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhr/wAARCAAoACgDASIAAhEBAxEB/8QAGgAAAgMBAQAAAAAAAAAAAAAAAAgEBQYBCf/EADQQAAEDAwEEBwUJAAAAAAAAAAIAAQQDBRIGBxETURUhIjJCUmIWgYKisggUFyczNEFTZ//EABkBAAMBAQEAAAAAAAAAAAAAAAMFBgIEB//EACQRAAEEAgEDBQEAAAAAAAAAAAMAAQIEERIFEyHCFCIxMoKS/9oADAMBAAIRAxEAPwB85kwIdPI/c3NZyVc68ot+TgHJmVHtFmhV0xqApFSbTj04FdiKA2+QI8Msipevy+pKXC1zGgEIWXbHe7Mfhj6js9Qh+IxHFcsti7aSUtctkKTSH1Ti5Fv35OpsW5Vo795zDk6V32y2hjZBuhbRtAdBvW4PS2RfqY5YY445Y9rHJZGbrmNNMgvG2O93gvFH09ZzEfhPHH5ks9ObbaJP52l4oIpyD7op8YcsJdNiB+v+W5IWE2cy6Q6a08cc5px6lvoMJT/3BNgOL1fX5vUhbrXR2IPv8x7KpCRyQy6muzsT71An2O2XQSa5W+JMEv76An9SvLjGePJPyH1soqS2iyCSUVNtX6ctZJBgCgWzKJGKmBRvxSKjwsezjwy7KeqBYbZaxFrbbokPHu8CgIfSkJpVvy3hv/rZN8hL0HQebsSjGP68UyCHVdHvDihS7bQevIHyB1uhJqXHWLgurB8MmjCwr6ZDCVTcT9z8ln5FurR37ubc2QhW/KVBGC5JN3ZYmOMnylqD7L9YbBQs3T4vSpaz9pOL927WPDIeFj5t/iTLx7dWkP3cG5uhCj6zPylhh2HyzIg4sr6NFCIGFP3vzQhC9JEKAIMMbYZkRf/Z",sudt_script_hash:"",address:"0x8290f27935A2D353adc834c9F3c5F6ef19635C2D",issuerLockHash:"0x13d640a864c7e84d60afd8ca9c6689d345a18f63e2e426c9623a2811776cf211",l1Lock:{code_hash:"0xc5e5dcf215925f7ef4dfaf5f4b4f105bc321c02776d6e7d52a1db3fcd9d011a4",hash_type:"type",args:"0x13d640a864c7e84d60afd8ca9c6689d345a18f63e2e426c9623a2811776cf211"}}];var A=n(63);function k(e){return function(t,n){if(!(n instanceof ArrayBuffer)){let a=BigInt(n).toString(16);if(a.length%2!==0&&(a="0"+a),a.length/2>e)throw new Error("".concat(t," is ").concat(a.length/2," bytes long, expected length is ").concat(e,"!"));const i=new DataView(new ArrayBuffer(e));for(let e=0;e<a.length/2;e++){const t=a.length-2*(e+1);i.setUint8(e,parseInt(a.substr(t,2),16))}n=i.buffer}if(n.byteLength<e){const t=new Uint8Array(e);t.set(new Uint8Array(n),0),n=t.buffer}return n}}function O(e){return function(t,n){if(n=new A.Reader(n).toArrayBuffer(),e>0&&n.byteLength!==e)throw new Error("".concat(t," has invalid length ").concat(n.byteLength,", required: ").concat(e));return n}}function z(e,t,n){const a={};for(const[i,s]of Object.entries(n)){const n=t[i];if(void 0===n||null===n)throw new Error("".concat(e," is missing ").concat(i,"!"));a[i]=s("".concat(e,".").concat(i),n)}return a}function B(e){return function(t,n){return e(n,{debugPath:t})}}function C(e){let{debugPath:t="fee"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{sudt_id:k(4),amount:k(16)})}function S(e){let{debugPath:t="raw_withdrawal_request"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{nonce:k(4),capacity:k(8),amount:k(16),sudt_script_hash:O(32),account_script_hash:O(32),sell_amount:k(16),sell_capacity:k(8),owner_lock_hash:O(32),payment_lock_hash:O(32),fee:B(C)})}const I={CKB_INDEXER_URL:"https://testnet.ckb.dev/indexer",CKB_RPC_URL:"https://testnet.ckb.dev",GW_POLYJUICE_RPC_URL:"https://godwoken-testnet-web3-rpc.ckbapp.dev"},U={CKB_INDEXER_URL:"https://testnet.ckb.dev/indexer",CKB_RPC_URL:"https://testnet.ckb.dev",GW_POLYJUICE_RPC_URL:"https://godwoken-testnet-web3-rpc.ckbapp.dev"};var N=n(370);function R(e,t){throw new Error("Invalid data length! Required: ".concat(t,", actual: ").concat(e))}function E(e,t){e!==t&&R(e,t)}function L(e){if(e instanceof Object&&e.toArrayBuffer instanceof Function&&(e=e.toArrayBuffer()),!(e instanceof ArrayBuffer))throw new Error("Provided value must be an ArrayBuffer or can be transformed into ArrayBuffer!");return e}function T(e){const t=e.length;let n=4*(t+1);const a=[];for(let c=0;c<t;c++)a.push(n),n+=e[c].byteLength;const i=new ArrayBuffer(n),s=new Uint8Array(i),r=new DataView(i);r.setUint32(0,n,!0);for(let c=0;c<t;c++)r.setUint32(4+4*c,a[c],!0),s.set(new Uint8Array(e[c]),a[c]);return i}function M(e){const t=new Uint8Array(0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()+V.size()+V.size()+P.size());new DataView(t.buffer);return t.set(new Uint8Array(F(e.nonce)),0),t.set(new Uint8Array(Q(e.capacity)),0+q.size()),t.set(new Uint8Array(K(e.amount)),0+q.size()+H.size()),t.set(new Uint8Array(Y(e.sudt_script_hash)),0+q.size()+H.size()+J.size()),t.set(new Uint8Array(Y(e.account_script_hash)),0+q.size()+H.size()+J.size()+V.size()),t.set(new Uint8Array(K(e.sell_amount)),0+q.size()+H.size()+J.size()+V.size()+V.size()),t.set(new Uint8Array(Q(e.sell_capacity)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()),t.set(new Uint8Array(Y(e.owner_lock_hash)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()),t.set(new Uint8Array(Y(e.payment_lock_hash)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()+V.size()),t.set(new Uint8Array(G(e.fee)),0+q.size()+H.size()+J.size()+V.size()+V.size()+J.size()+H.size()+V.size()+V.size()),t.buffer}function W(e){const t=[];return t.push(M(e.raw)),t.push(X(e.signature)),T(t)}function D(e){return T([])}class P{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}getSudtId(){return new q(this.view.buffer.slice(0,0+q.size()),{validate:!1})}getAmount(){return new J(this.view.buffer.slice(0+q.size(),0+q.size()+J.size()),{validate:!1})}validate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];E(this.view.byteLength,P.size()),this.getSudtId().validate(e),this.getAmount().validate(e)}static size(){return 0+q.size()+J.size()}}function G(e){const t=new Uint8Array(0+q.size()+J.size());new DataView(t.buffer);return t.set(new Uint8Array(F(e.sudt_id)),0),t.set(new Uint8Array(K(e.amount)),0+q.size()),t.buffer}class q{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){E(this.view.byteLength,4)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}toBigEndianUint32(){return this.view.getUint32(0,!1)}toLittleEndianUint32(){return this.view.getUint32(0,!0)}static size(){return 4}}function F(e){const t=L(e);return E(t.byteLength,4),t}class H{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){E(this.view.byteLength,8)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}toBigEndianBigUint64(){return this.view.getBigUint64(0,!1)}toLittleEndianBigUint64(){return this.view.getBigUint64(0,!0)}static size(){return 8}}function Q(e){const t=L(e);return E(t.byteLength,8),t}class J{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){E(this.view.byteLength,16)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}static size(){return 16}}function K(e){const t=L(e);return E(t.byteLength,16),t}class V{constructor(e){let{validate:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=new DataView(L(e)),t&&this.validate()}validate(){E(this.view.byteLength,32)}indexAt(e){return this.view.getUint8(e)}raw(){return this.view.buffer}static size(){return 32}}function Y(e){const t=L(e);return E(t.byteLength,32),t}function X(e){const t=L(e),n=new Uint8Array(4+t.byteLength);return new DataView(n.buffer).setUint32(0,t.byteLength,!0),n.set(new Uint8Array(t),4),n.buffer}class Z{constructor(e){this.rpc=void 0,this.rpc=new A.RPC(e)}async rpcCall(e){const t="gw_"+e;for(var n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return await this.rpc[t](...a)}async submitWithdrawalRequest(e){const t=new A.Reader(W(function(e){let{debugPath:t="withdrawal_request"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{raw:B(S),signature:O(65)})}(e))).serializeJson();return await this.rpcCall("submit_withdrawal_request",t)}async getAccountIdByScriptHash(e){return await this.rpcCall("get_account_id_by_script_hash",e)}async getScriptHashByShortAddress(e){return await this.rpcCall("get_script_hash_by_short_address",e)}async getWithdrawal(e){return await this.rpcCall("get_withdrawal",e)}async getNonce(e){return await this.rpcCall("get_nonce",e)}async getLastSubmittedInfo(){return await this.rpcCall("get_last_submitted_info")}async getScriptHash(e){return await this.rpcCall("get_script_hash",e)}}var $=n(373),ee=n.n($);function te(e,t){throw new Error("Invalid data length! Required: ".concat(t,", actual: ").concat(e))}function ne(e,t){e!==t&&te(e,t)}function ae(e){if(e instanceof Object&&e.toArrayBuffer instanceof Function&&(e=e.toArrayBuffer()),!(e instanceof ArrayBuffer))throw new Error("Provided value must be an ArrayBuffer or can be transformed into ArrayBuffer!");return e}function ie(e){const t=e.length;let n=4*(t+1);const a=[];for(let c=0;c<t;c++)a.push(n),n+=e[c].byteLength;const i=new ArrayBuffer(n),s=new Uint8Array(i),r=new DataView(i);r.setUint32(0,n,!0);for(let c=0;c<t;c++)r.setUint32(4+4*c,a[c],!0),s.set(new Uint8Array(e[c]),a[c]);return i}function se(e){const t=[];return t.push(function(e){const t=ae(e);return ne(t.byteLength,21),t}(e.identity)),t.push(function(e){return ie(e.map((e=>function(e){const t=[],n=new DataView(new ArrayBuffer(1));return n.setUint8(0,e.mask),t.push(n.buffer),t.push(ce(e.proof)),ie(t)}(e))))}(e.proofs)),ie(t)}function re(e){const t=[];return t.push(le(e.signature)),t.push(function(e){return e?se(e):new ArrayBuffer(0)}(e.rc_identity)),t.push(le(e.preimage)),ie(t)}function ce(e){const t=ae(e),n=new Uint8Array(4+t.byteLength);return new DataView(n.buffer).setUint32(0,t.byteLength,!0),n.set(new Uint8Array(t),4),n.buffer}function oe(e){const t=ae(e),n=new Uint8Array(4+t.byteLength);return new DataView(n.buffer).setUint32(0,t.byteLength,!0),n.set(new Uint8Array(t),4),n.buffer}function le(e){return e?oe(e):new ArrayBuffer(0)}const de={web3Url:I.GW_POLYJUICE_RPC_URL,abiItems:[{inputs:[{internalType:"string",name:"name_",type:"string"},{internalType:"string",name:"symbol_",type:"string"},{internalType:"uint256",name:"totalSupply_",type:"uint256"},{internalType:"uint256",name:"sudtId_",type:"uint256"},{internalType:"uint8",name:"decimals_",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"sudtId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"sender",type:"address"},{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"addedValue",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"subtractedValue",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]},pe=new N.PolyjuiceHttpProvider(de.web3Url,de);class he{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AGGRON";if(this.l2Address="",this.l1Address="",this.ckbIndexer=void 0,this.rpc=void 0,this.ethereum=void 0,this.web3=void 0,this.godwokenClient=void 0,"AGGRON"===n)p.config.initializeConfig(p.config.predefined.AGGRON4),this.ckbIndexer=new p.Indexer(U.CKB_INDEXER_URL,U.CKB_RPC_URL),this.rpc=new p.RPC(U.CKB_RPC_URL),this.godwokenClient=new Z(I.GW_POLYJUICE_RPC_URL);else{if("LINA"!==n)throw new Error("env not defined, please use AGGRON or LINA.");p.config.initializeConfig(p.config.predefined.LINA),this.ckbIndexer=new p.Indexer(I.CKB_INDEXER_URL,I.CKB_RPC_URL),this.rpc=new p.RPC(I.CKB_RPC_URL),this.godwokenClient=new Z(I.GW_POLYJUICE_RPC_URL)}this.ethereum=t,this.l2Address=e,this.l1Address=this.generateL1Address(this.l2Address),t.on("accountsChanged",(e=>{console.log("eth accounts changed",e),this.l2Address=e[0],this.l1Address=this.generateL1Address(this.l2Address)})),this.web3=new ee.a(pe)}async sendWithdrawTransaction(e){return await this.godwokenClient.submitWithdrawalRequest(e)}getL2Address(){return this.l2Address}getL1Address(){return this.l1Address}static async CreateProvider(e){if(!e||!e.isMetaMask)throw new Error("please provide metamask ethereum object");return e.request({method:"eth_requestAccounts"}).then((t=>(console.log("eth_requestAccounts",t),new he(t[0],e)))).catch((e=>{4001===e.code?console.log("Please connect to MetaMask."):console.error(e)}))}generateL1Address(e){const t={code_hash:x.code_hash,hash_type:x.hash_type,args:"0x01".concat(e.substring(2),"00")};return p.helpers.generateAddress(t)}async sendL1Transaction(e){return await this.rpc.send_transaction(e,"passthrough")}async signL1Transaction(e){const t=this.generateMessage(e);let n=await this.ethereum.request({method:"personal_sign",params:[this.ethereum.selectedAddress,t]}),a=Number.parseInt(n.slice(-2),16);a>=27&&(a-=27),n="0x"+n.slice(2,-2)+a.toString(16).padStart(2,"0");const i=new p.toolkit.Reader(p.core.SerializeWitnessArgs({lock:re({signature:new p.toolkit.Reader(n)})})).serializeJson();e=e.update("witnesses",(e=>e.push("".concat(i))));return p.helpers.createTransactionFromSkeleton(e)}generateMessage(e){const t=new p.utils.CKBHasher,n=p.utils.ckbHash(p.core.SerializeRawTransaction(p.toolkit.normalizers.NormalizeRawTransaction(p.helpers.createTransactionFromSkeleton(e)))),a=p.core.SerializeWitnessArgs({lock:new p.toolkit.Reader("0x"+"00".repeat(re({signature:new p.toolkit.Reader("0x"+"00".repeat(65))}).byteLength))});return t.update(n),this.hashWitness(t,a),t.digestHex()}hashWitness(e,t){const n=new ArrayBuffer(8);new DataView(n).setBigUint64(0,BigInt(new p.toolkit.Reader(t).length()),!0),e.update(n),e.update(t)}async getPendingTransaction(e){let t=null;for(let n=0;n<10;n++){if(t=await this.rpc.get_transaction(e),null!=t)return t;await this.asyncSleep(1e3)}return null}async getRollupCellDep(){const e=(await this.godwokenClient.getLastSubmittedInfo()).transaction_hash,t=await this.getPendingTransaction(e);if(null==t)throw new Error("Last submitted tx not found!");let n=t.transaction.outputs.findIndex((e=>e.type&&p.utils.computeScriptHash(e.type)===j));return{out_point:{tx_hash:e,index:"0x".concat(n.toString(16))},dep_type:"code"}}async getRollupCell(){const e={type:{code_hash:_.code_hash,hash_type:_.hash_type,args:_.args}},t=this.ckbIndexer.collector(e);let n;for await(const a of t.collect()){if(null===a)return;n=a;break}return n}async getLastFinalizedBlockNumber(){const e=await this.getRollupCell();if(void 0===!e)return 0;const t=new h.core.GlobalState(new p.toolkit.Reader(e.data)),n=Number(t.getLastFinalizedBlockNumber().toLittleEndianBigUint64());return console.log("last finalized block number: ",n),n}async asyncSleep(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((t=>setTimeout(t,e)))}}class ue{constructor(e){this.provider=void 0,this.provider=e}getBlockProduceTime(){return 45e3}async unlock(e){const t=this.provider.l1Address,n=p.helpers.parseAddress(t),a=[];if(e.cell.cell_output.type){const t={cell_output:{capacity:"0x0",lock:n,type:e.cell.cell_output.type},data:e.cell.data},i=p.helpers.minimalCellCapacity(t),s=BigInt(e.cell.cell_output.capacity)-i;a.push({cell_output:{capacity:"0x".concat(s.toString(16)),lock:n},data:"0x"}),a.push({cell_output:{capacity:"0x".concat(i.toString(16)),lock:n,type:e.cell.cell_output.type},data:e.cell.data})}else a.push({cell_output:{capacity:e.cell.cell_output.capacity,lock:n,type:e.cell.cell_output.type},data:e.cell.data});const i={lock:"0x00000000"+new p.toolkit.Reader(D(p.toolkit.normalizers.NormalizeWitnessArgs({}))).serializeJson().slice(2)},s=new p.toolkit.Reader(p.core.SerializeWitnessArgs(p.toolkit.normalizers.NormalizeWitnessArgs(i))).serializeJson();let r=p.helpers.TransactionSkeleton({cellProvider:this.provider.ckbIndexer});const c={out_point:{tx_hash:x.tx_hash,index:x.index},dep_type:x.dep_type},o={out_point:{tx_hash:y.tx_hash,index:y.index},dep_type:y.dep_type},l={out_point:{tx_hash:f.cell_dep.out_point.tx_hash,index:f.cell_dep.out_point.index},dep_type:f.cell_dep.dep_type},d=await this.provider.getRollupCellDep();if(r=r.update("inputs",(t=>t.push(e.cell))).update("outputs",(e=>e.push(...a))).update("cellDeps",(e=>e.push(l))).update("cellDeps",(e=>e.push(d))).update("cellDeps",(e=>e.push(c))).update("cellDeps",(e=>e.push(o))).update("witnesses",(e=>e.push(s))),e.cell.cell_output.type){const e={out_point:{tx_hash:m.tx_hash,index:m.index},dep_type:m.dep_type};r=r.update("cellDeps",(t=>t.push(e)))}r=await this.injectCapacity(r,n,BigInt(0));const h=await this.provider.signL1Transaction(r);return await this.provider.sendL1Transaction(h)}async listWithdraw(){const e=this.getWithdrawalCellSearchParams(this.provider.l2Address);console.log("searchParams is:",e);const t=[],n=this.provider.ckbIndexer.collector({lock:e.script}),a=await this.provider.getLastFinalizedBlockNumber(),i=p.helpers.parseAddress(this.provider.l1Address),s={code_hash:i.code_hash,args:i.args,hash_type:i.hash_type},r=p.utils.computeScriptHash(s);for await(const o of n.collect()){const e=o.cell_output.lock.args,n=new h.core.WithdrawalLockArgs(new p.toolkit.Reader("0x".concat(e.slice(66))));if(null==n)continue;const i=Number(n.getWithdrawalBlockNumber().toLittleEndianBigUint64()),s=o.cell_output.lock.args.includes(r.substring(2));let c,l="0x"+"00".repeat(32),d="0x0";if(o.cell_output.type){const e={code_hash:o.cell_output.type.code_hash,args:o.cell_output.type.args,hash_type:o.cell_output.type.hash_type};l=p.utils.computeScriptHash(e);c=this.getBuiltinErc20List().find((e=>e.sudt_script_hash===l)),d="0x".concat(p.utils.readBigUInt128LE(o.data).toString(16))}s&&t.push({cell:o,withdrawalBlockNumber:i,remainingBlockNumber:Math.max(0,i-a),capacity:o.cell_output.capacity,amount:d,sudt_script_hash:l,erc20:c})}const c=t.sort(((e,t)=>e.withdrawalBlockNumber-t.withdrawalBlockNumber));return console.log("found withdraw cells:",c),c}getWithdrawalCellSearchParams(e){if(42!==e.length||!e.startsWith("0x"))throw new Error("eth address format error!");const t={code_hash:w.script_type_hash,hash_type:"type",args:j+e.slice(2).toLowerCase()},n=p.utils.computeScriptHash(t);return{script:{code_hash:f.script_type_hash,hash_type:"type",args:"".concat(j).concat(n.slice(2))},script_type:"lock"}}withdrawWithEvent(e){const t=new b.a;return this.withdraw(t,e),t}async withdraw(e,t){e.emit("sending");const n=j,a=w.script_type_hash;console.log(" helpers.parseAddress(payload.withdrawal_address || this.provider.l1Address)",t,this.provider);const i=p.helpers.parseAddress(t.withdrawal_address||this.provider.l1Address),s=p.utils.computeScriptHash(i),r={code_hash:a,hash_type:"type",args:n+this.provider.l2Address.slice(2)},c=p.utils.computeScriptHash(r);console.log("account script hash:",c);const o=await this.provider.godwokenClient.getAccountIdByScriptHash(c);if(!o)throw new Error("account not found");const l="0x0000000000000000000000000000000000000000000000000000000000000000"!==t.sudt_script_hash,d=this.minimalWithdrawalCapacity(l);if(BigInt(t.capacity)<BigInt(d))throw new Error("Withdrawal required ".concat(BigInt(d)," shannons at least, provided ").concat(BigInt(t.capacity),"."));const h=await this.provider.godwokenClient.getNonce(o);console.log("nonce:",h);const u="0x"+"00".repeat(32),b={nonce:"0x"+BigInt(h).toString(16),capacity:"0x"+BigInt(t.capacity).toString(16),amount:"0x"+BigInt(t.amount).toString(16),sudt_script_hash:t.sudt_script_hash,account_script_hash:c,sell_amount:"0x0",sell_capacity:"0x0",owner_lock_hash:s,payment_lock_hash:u,fee:{sudt_id:"0x1",amount:"0x0"}};console.log("rawWithdrawalRequest:",b);const g=this.generateWithdrawalMessageToSign(b,n);console.log("message:",g);const x=await this.signMessageMetamaskPersonalSign(g);console.log("signatureMetamaskPersonalSign:",x);const f={raw:b,signature:x};let y;console.log("withdrawalRequest:",f);try{y=await this.provider.godwokenClient.submitWithdrawalRequest(f)}catch(v){return void e.emit("error",v)}e.emit("sent",y),console.log("withdrawal request result:",y);let m=0;const _=setInterval((async()=>{m++;const t=await this.getWithdrawal(y);t&&"pending"===t.status&&(console.log("withdrawal pending:",t),e.emit("pending",y)),t&&"committed"===t.status&&(console.log("withdrawal committed:",t),e.emit("success",y),clearInterval(_)),null===t&&m>100&&(e.emit("fail",y),clearInterval(_))}),1e4)}async getWithdrawal(e){const t=await this.provider.godwokenClient.getWithdrawal(e);return console.log("getWithdrawal result:",t),t}async signMessageMetamaskPersonalSign(e){let t=await this.provider.ethereum.request({method:"personal_sign",params:[this.provider.l2Address,e]}),n=Number.parseInt(t.slice(-2),16);return n>=27&&(n-=27),t="0x"+t.slice(2,-2)+n.toString(16).padStart(2,"0"),t}async signMessageMetamaskEthSign(e){let t=await this.provider.ethereum.request({method:"eth_sign",params:[this.provider.l2Address,e]}),n=Number.parseInt(t.slice(-2),16);return n>=27&&(n-=27),t="0x"+t.slice(2,-2)+n.toString(16).padStart(2,"0"),t}signMessage(e,t){const n=g.ecdsaSign(new Uint8Array(new p.toolkit.Reader(e).toArrayBuffer()),new Uint8Array(new p.toolkit.Reader(t).toArrayBuffer())),a=new ArrayBuffer(65),i=new Uint8Array(a);i.set(n.signature,0);let s=n.recid;s>=27&&(s-=27),i.set([s],64);return new p.toolkit.Reader(a).serializeJson()}generateWithdrawalMessageToSign(e,t){const n=new p.toolkit.Reader(M(S(e))).serializeJson(),a=new p.toolkit.Reader(t+n.slice(2)).toArrayBuffer();return p.utils.ckbHash(a).serializeJson()}minimalWithdrawalCapacity(e){const t="0x"+"00".repeat(32),n="0x0",a=t,i={account_script_hash:t,withdrawal_block_hash:t,withdrawal_block_number:n,sudt_script_hash:t,sell_amount:n,sell_capacity:n,owner_lock_hash:t,payment_lock_hash:t},s=new p.toolkit.Reader(function(e){const t=new Uint8Array(0+V.size()+V.size()+H.size()+V.size()+J.size()+H.size()+V.size()+V.size());return new DataView(t.buffer),t.set(new Uint8Array(Y(e.account_script_hash)),0),t.set(new Uint8Array(Y(e.withdrawal_block_hash)),0+V.size()),t.set(new Uint8Array(Q(e.withdrawal_block_number)),0+V.size()+V.size()),t.set(new Uint8Array(Y(e.sudt_script_hash)),0+V.size()+V.size()+H.size()),t.set(new Uint8Array(K(e.sell_amount)),0+V.size()+V.size()+H.size()+V.size()),t.set(new Uint8Array(Q(e.sell_capacity)),0+V.size()+V.size()+H.size()+V.size()+J.size()),t.set(new Uint8Array(Y(e.owner_lock_hash)),0+V.size()+V.size()+H.size()+V.size()+J.size()+H.size()),t.set(new Uint8Array(Y(e.payment_lock_hash)),0+V.size()+V.size()+H.size()+V.size()+J.size()+H.size()+V.size()),t.buffer}(function(e){let{debugPath:t="withdrawal_lock_args"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return z(t,e,{account_script_hash:O(32),withdrawal_block_hash:O(32),withdrawal_block_number:k(8),sudt_script_hash:O(32),sell_amount:k(16),sell_capacity:k(8),owner_lock_hash:O(32),payment_lock_hash:O(32)})}(i))).serializeJson(),r={code_hash:t,hash_type:"data",args:a+s.slice(2)};let c,o="0x";e&&(c={code_hash:t,hash_type:"data",args:t},o="0x"+"00".repeat(16));const l={cell_output:{lock:r,type:c,capacity:n},data:o};return"0x"+p.helpers.minimalCellCapacity(l).toString(16)}async getL2CkbBalance(e){const t=await this.provider.web3.eth.getBalance((null===e||void 0===e?void 0:e.l2Address)||this.provider.l2Address);return"0x"+Number(t).toString(16)}getBuiltinErc20List(){const e=[];return v.forEach((t=>{const n={code_hash:t.l1Lock.code_hash,args:t.l1Lock.args,hash_type:t.l1Lock.hash_type},a=p.utils.computeScriptHash(n);e.push({name:t.name,symbol:t.symbol,decimals:t.decimals,address:t.address,tokenURI:t.tokenURI,sudt_script_hash:a})})),e}async getErc20Balances(e){const t={balances:[]};let n=[];for(let a=0;a<e.addresses.length;a++){const t=e.addresses[a],i=new this.provider.web3.eth.Contract(de.abiItems,t).methods.balanceOf(this.provider.l2Address).call();n.push(i)}return await Promise.all(n).then((e=>{e.forEach((e=>{t.balances.push("0x"+Number(e).toString(16))}))})),t}async injectCapacity(e,t,n){const a=n+BigInt(1e5);let i=BigInt(0);const s=[],r=this.provider.ckbIndexer.collector({lock:t,type:"empty"});for await(const o of r.collect())if((!o.data||"0x"===o.data||"0x0"===o.data||"0x00"===o.data)&&(i+=BigInt(o.cell_output.capacity),s.push(o),i>=a))break;if(i<a)throw new Error("Not enough CKB, expected: ".concat(a,", actual: ").concat(i," "));const c={cell_output:{capacity:"0x"+BigInt(i-a).toString(16),lock:t},data:"0x"};return e=(e=e.update("inputs",(e=>e.push(...s)))).update("outputs",(e=>e.push(c)))}}var be=n(2);const ge=Object(a.createContext)(null),xe=e=>{const[t,n]=Object(a.useState)();return Object(a.useEffect)((()=>{d()().then((e=>{e.request({method:"eth_accounts"}).then((t=>{if(!t||!t[0])return;const a=new ue(new he(t[0],e));n(a)})),e.on("accountsChanged",(t=>{if(!t||!t[0])return n(void 0);const a=new ue(new he(e.selectedAddress,e));n(a)}))}))}),[]),Object(be.jsx)(ge.Provider,{value:t||null,children:e.children})};var fe=n(26),we=n(829),ye=n(830),me=n(831),je=n(825),_e=n(826),ve=n(397),Ae=n(96),ke=n(27);const Oe=()=>Object(a.useContext)(ge),ze=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=e.toString();if(0===t)return n;const a=n.slice(0,-t)||"0",i="0"===a?1e8:1e4;let s=n.slice(-t).padStart(t,"0").slice(0,"0"===a?9:5);return s=(Math.round(Number("0.".concat(s))*i)/i).toFixed("0"===a?8:4).replace(/(\d)0+$/,"$1").slice(2),"".concat(a).concat("0"===s?"":".".concat(s))},Be=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{maxDecimalPlace:a=4}=n,i=e.toString();if(0===t)return i;const s=i.slice(0,-t)||"0",r=i.slice(-t).padStart(t,"0").replace(/(\d)0+$/,"$1").slice(0,a);return"".concat(s).concat("0"===r?"":".".concat(r))};var Ce;const Se=ke.a.input(Ce||(Ce=Object(fe.a)(["\n  width: 0;\n  position: relative;\n  font-weight: 500;\n  outline: none;\n  border: none;\n  flex: 1 1 auto;\n  background-color: transparent;\n  font-size: 16px;\n  text-align: ",';\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding: 0px;\n  -webkit-appearance: textfield;\n\n  ::-webkit-search-decoration {\n    -webkit-appearance: none;\n  }\n\n  [type="number"] {\n    -moz-appearance: textfield;\n  }\n\n  ::-webkit-outer-spin-button,\n  ::-webkit-inner-spin-button {\n    -webkit-appearance: none;\n  }\n\n  :disabled {\n    cursor: text;\n  }\n'])),(e=>{let{align:t}=e;return t&&t}));const Ie=RegExp("^\\d*(?:\\\\[.])?\\d*$");var Ue,Ne,Re=i.a.memo((function(e){let{value:t,onUserInput:n,placeholder:a,...i}=e;return Object(be.jsx)(Se,{...i,value:t,onChange:e=>{var t;(""===(t=e.target.value.replace(/,/g,"."))||Ie.test(t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")))&&n(t)},inputMode:"decimal",title:"Token Amount",autoComplete:"off",autoCorrect:"off",type:"text",pattern:"^[0-9]*[.,]?[0-9]*$",placeholder:a||"0.0",minLength:1,maxLength:79,spellCheck:"false"})}));const Ee=ke.a.div(Ue||(Ue=Object(fe.a)(["\n  font-size: 14px;\n  border-radius: 16px;\n  background-color: rgb(60, 58, 75);\n  box-shadow: rgb(74 74 104 / 10%) 0px 2px 2px -1px;\n  .first-row {\n    margin-bottom: 3px;\n    padding: 0.75rem 1rem 0px;\n  }\n  .anticon {\n    font-size: 12px;\n  }\n\n  .input-wrapper {\n    padding: 0.75rem 0.5rem 0.75rem 1rem;\n  }\n"]))),Le=ke.a.div(Ne||(Ne=Object(fe.a)(["\n  display: flex;\n  justify-content: space-between;\n  .ant-typography {\n    color: white;\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n  .ckb-logo {\n    height: 24px;\n    width: 24px;\n    margin-right: 8px;\n  }\n  .max-button {\n    height: 32px;\n    padding: 0px 16px;\n    background-color: transparent;\n    color: rgb(255, 67, 66);\n    font-weight: 600;\n    &:hover {\n      cursor: pointer;\n    }\n  }\n"])));function Te(e){let{value:t,onUserInput:n,label:i}=e;const[s,r]=Object(a.useState)(!0),[c,o]=Object(a.useState)(""),l=Oe();Object(a.useEffect)((()=>{(async()=>{const e=await(null===l||void 0===l?void 0:l.getL2CkbBalance())||"";o(e)})()}),[l]),Object(a.useEffect)((()=>{t!==ze(BigInt(c),8)?r(!0):r(!1)}),[t,c]);return Object(be.jsxs)(Ee,{children:[Object(be.jsxs)(Le,{className:"first-row",children:[Object(be.jsx)(je.a.Text,{children:i}),Object(be.jsxs)(je.a.Text,{children:["Balance: ",ze(BigInt(c),8)||""]})]}),Object(be.jsxs)(Le,{className:"input-wrapper",children:[Object(be.jsx)(Re,{className:"token-amount-input",value:t,placeholder:"Minimum 400 CKB",onUserInput:e=>{n(e)}}),s&&Object(be.jsx)(je.a.Text,{className:"max-button",onClick:()=>{n(ze(BigInt(c),8)),r(!1)},children:"MAX"}),Object(be.jsx)("img",{className:"ckb-logo",src:"./static/ckb.svg",alt:""}),Object(be.jsx)(je.a.Text,{children:"CKB"})]})]})}var Me=n(824),We=n(828),De=n(399);const Pe=3600,Ge=86400,qe=2629800,Fe=31557600;var He,Qe,Je,Ke,Ve,Ye=e=>{let t=Math.abs(e);const n={years:0,months:0,days:0,hours:0,minutes:0,seconds:0};return t>=Fe&&(n.years=Math.floor(t/Fe),t-=n.years*Fe),t>=qe&&(n.months=Math.floor(t/qe),t-=n.months*qe),t>=Ge&&(n.days=Math.floor(t/Ge),t-=n.days*Ge),t>=Pe&&(n.hours=Math.floor(t/Pe),t-=n.hours*Pe),t>=60&&(n.minutes=Math.floor(t/60),t-=60*n.minutes),n.seconds=Math.floor(t),n};const{Text:Xe}=je.a,Ze=ke.a.div(He||(He=Object(fe.a)(["\n  background: rgb(39, 37, 52);\n  padding: 16px;\n  border-radius: 12px;\n  .header {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    font-weight: 400;\n    line-height: 1.5;\n    font-size: 14px;\n  }\n  .icons {\n    display: flex;\n    img {\n      width: 20px;\n      height: 20px;\n      margin-right: 5px;\n    }\n  }\n  .ckb-icon {\n    width: 20px;\n    height: 20px;\n    background: url(./static/ckb.svg) no-repeat no-repeat;\n    background-size: contain;\n  }\n  .number {\n    margin-top: 3px;\n  }\n  .time {\n    align-self: center;\n    display: flex;\n    height: 40px;\n    align-items: center;\n    .ant-typography {\n      padding-right: 5px;\n    }\n  }\n  .ant-typography {\n    color: white;\n  }\n  .list-detail {\n    padding-top: 10px;\n  }\n"]))),$e=Object(ke.a)(Ae.a)(Qe||(Qe=Object(fe.a)(["\n  align-items: center;\n  border: 0px;\n  border-radius: 16px;\n  box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n  cursor: pointer;\n  display: inline-flex;\n  font-family: inherit;\n  font-size: 16px;\n  font-weight: 600;\n  -webkit-box-pack: center;\n  justify-content: center;\n  letter-spacing: 0.03em;\n  line-height: 1;\n  opacity: 1;\n  outline: 0px;\n  transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n  height: 32px;\n  padding: 0px 16px;\n  background-color: rgb(255, 67, 66);\n  color: white;\n  margin-left: 4px;\n  margin-top: 8px;\n  &:hover,\n  &:focus,\n  &:active {\n    background-color: rgb(255, 67, 66);\n    color: white;\n  }\n"]))),et=ke.a.div(Je||(Je=Object(fe.a)(["\n  align-items: center;\n  border: 0px;\n  border-radius: 16px;\n  box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n  cursor: pointer;\n  display: inline-flex;\n  font-family: inherit;\n  font-size: 16px;\n  font-weight: 600;\n  -webkit-box-pack: center;\n  justify-content: center;\n  letter-spacing: 0.03em;\n  line-height: 1;\n  opacity: 1;\n  outline: 0px;\n  transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n  height: 32px;\n  padding: 0px 16px;\n  background-color: rgb(60, 58, 75);\n  color: white;\n  margin-left: 4px;\n  margin-top: 8px;\n  &:hover,\n  &:focus,\n  &:active {\n    background-color: rgb(60, 58, 75);\n    color: white;\n  }\n"]))),tt=ke.a.div(Ke||(Ke=Object(fe.a)(["\n  height: 24px;\n  display: flex;\n  justify-content: space-between;\n  .ant-typography {\n    color: white;\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n"]))),nt=Object(ke.a)(_e.a)(Ve||(Ve=Object(fe.a)(["\n  color: white;\n  .ant-modal-content {\n    border-radius: 32px;\n    background: rgb(39, 37, 52);\n    box-shadow: rgb(14 14 44 / 10%) 0px 20px 36px -8px, rgb(0 0 0 / 5%) 0px 1px 1px;\n    border: 1px solid rgb(60, 58, 75);\n    color: white;\n  }\n  .ant-modal-header {\n    background: rgb(39, 37, 52);\n    border: 1px solid rgb(60, 58, 75);\n    border-top-left-radius: 32px;\n    border-top-right-radius: 32px;\n    padding: 12px 24px;\n    height: 73px;\n    display: flex;\n    align-items: center;\n  }\n  .ant-modal-title {\n    color: white;\n  }\n  .ant-modal-body {\n    padding: 20px;\n  }\n  .ant-modal-close-x {\n    color: white;\n  }\n  .ant-typography {\n    color: white;\n    display: block;\n  }\n  .ant-typography.title {\n    font-size: 20px;\n    padding-bottom: 10px;\n  }\n  .actions {\n    padding-top: 20px;\n    display: flex;\n    justify-content: center;\n  }\n  .confirm {\n    margin-left: 30px;\n  }\n  .confirm,\n  .cancel {\n    border-radius: 6px;\n  }\n"])));var at,it,st,rt,ct=e=>{let{remainingBlockNumber:t,capacity:n,amount:i,erc20:s,now:r=0,cell:c}=e;const[o,l]=Object(a.useState)(!1),[d,p]=Object(a.useState)(0),[h,u]=Object(a.useState)(!1),[b,g]=Object(a.useState)(!1),x=Oe(),f=Object(a.useCallback)((()=>{l((e=>!e))}),[]);Object(a.useEffect)((()=>{(async()=>{const e=await(null===x||void 0===x?void 0:x.getBlockProduceTime())||0;p(e)})()}),[x]);const w=Object(a.useMemo)((()=>Date.now()+t*d),[d,t]),y=Object(a.useMemo)((()=>Math.max(0,w-r)),[r,w]),m=Object(a.useMemo)((()=>0===t),[t]),{days:j,hours:_,minutes:v,seconds:A}=Object(a.useMemo)((()=>Ye(y/1e3)),[y]),[k,O]=Object(a.useMemo)((()=>{if("0"===n)return console.error("[warn] a withdrawal request cell with zero capacity"),["",""];const e=BigInt(n);return["".concat(ze(e,8)," CKB"),"".concat(Be(e,8)," CKB")]}),[n]),[z,B]=Object(a.useMemo)((()=>{if(""===i||!s)return["",""];const e=BigInt(i);return["".concat(ze(e,s.decimals)," ").concat(s.symbol),"".concat(Be(e,s.decimals)," ").concat(s.symbol)]}),[i,s]),C=()=>{u(!1)};return Object(be.jsxs)(Ze,{onClick:m?void 0:f,children:[Object(be.jsxs)("div",{className:"header",children:[Object(be.jsxs)("div",{className:"amount",children:[Object(be.jsxs)("div",{className:"icons",children:[null!==s&&void 0!==s&&s.tokenURI?Object(be.jsx)("img",{src:null===s||void 0===s?void 0:s.tokenURI,alt:""}):"",Object(be.jsx)("div",{className:"ckb-icon"})]}),Object(be.jsxs)("div",{className:"number",children:[z,""===z?"":" and ",k]})]}),m?Object(be.jsx)($e,{className:"withdraw-button",onClick:()=>{u(!0)},children:"withdraw"}):o?Object(be.jsx)("div",{className:"time",children:Object(be.jsx)(We.a,{})}):Object(be.jsxs)("div",{className:"time",children:[Object(be.jsx)(Xe,{title:"Estimated time left",children:j>0?"".concat(j).concat(j>1?" days":" day"):"".concat(_>0?"".concat(_.toString().padStart(2,"0"),":"):"").concat(v.toString().padStart(2,"0"),":").concat(A.toString().padStart(2,"0"))}),Object(be.jsx)(De.a,{})]})]}),o&&Object(be.jsxs)("div",{className:"list-detail",children:[Object(be.jsxs)(tt,{children:[Object(be.jsx)(Xe,{children:"Blocks remaining:"}),Object(be.jsx)(Xe,{children:t})]}),Object(be.jsxs)(tt,{children:[Object(be.jsx)(Xe,{children:"Estimated time left:"}),Object(be.jsx)(Xe,{children:"".concat(j>0?"".concat(j).concat(j>1?" days ":" day "):"").concat(_.toString().padStart(2,"0"),":").concat(v.toString().padStart(2,"0"),":").concat(A.toString().padStart(2,"0"))})]})]}),Object(be.jsxs)(nt,{title:"Withdraw to Wallet",visible:h,onOk:()=>{u(!1)},onCancel:C,footer:null,children:[Object(be.jsx)(Xe,{className:"title",children:"Confirm Unlock Withdrawal to below address"}),Object(be.jsx)(Xe,{children:null===x||void 0===x?void 0:x.provider.getL1Address()}),Object(be.jsxs)("div",{className:"actions",children:[Object(be.jsx)(et,{className:"cancel",onClick:C,children:"Cancel"}),Object(be.jsx)($e,{className:"confirm",onClick:async()=>{g(!0);const e=await(null===x||void 0===x?void 0:x.unlock({cell:c}));g(!1);u(!1),ve.a.success({message:"Unlock Tx(".concat(e,") is successful"),onClick:()=>{window.open("https://explorer.nervos.org/aggron/transaction/".concat(e),"_blank")}})},loading:b,children:"Confirm"})]})]})]})};const{Text:ot}=je.a,lt=ke.a.div(at||(at=Object(fe.a)(["\n  border-radius: 16px;\n  background-color: rgb(60, 58, 75);\n  box-shadow: rgb(74 74 104 / 10%) 0px 2px 2px -1px;\n  .first-row {\n    margin-bottom: 3px;\n  }\n  .anticon {\n    font-size: 12px;\n  }\n  .max-button {\n    height: 32px;\n    line-height: 32px;\n    padding: 0px 16px;\n    background-color: transparent;\n    color: rgb(255, 67, 66);\n    font-weight: 600;\n  }\n  .token-list {\n    height: 390px;\n    overflow-y: auto;\n  }\n  .first-row {\n    margin-bottom: 3px;\n    padding: 0.75rem 1rem 0px;\n  }\n  .input-wrapper {\n    height: 56px;\n    padding: 0.75rem 0.5rem 0.75rem 1rem;\n    display: flex;\n    align-items: center;\n  }\n  .currency-wrapper {\n    display: flex;\n    align-items: center;\n  }\n  .anticon {\n    margin-left: 10px;\n  }\n"]))),dt=ke.a.div(it||(it=Object(fe.a)(["\n  height: 390px;\n  overflow-y: auto;\n"]))),pt=Object(ke.a)(_e.a)(st||(st=Object(fe.a)(["\n  color: white;\n  .ant-modal-content {\n    border-radius: 32px;\n    background: rgb(39, 37, 52);\n    box-shadow: rgb(14 14 44 / 10%) 0px 20px 36px -8px, rgb(0 0 0 / 5%) 0px 1px 1px;\n    border: 1px solid rgb(60, 58, 75);\n    color: white;\n  }\n  .ant-modal-header {\n    background: rgb(39, 37, 52);\n    border: 1px solid rgb(60, 58, 75);\n    border-top-left-radius: 32px;\n    border-top-right-radius: 32px;\n    padding: 12px 24px;\n    height: 73px;\n    display: flex;\n    align-items: center;\n  }\n  .ant-modal-title,\n  .ant-list-item {\n    color: white;\n  }\n  .ant-modal-body {\n    padding: 0px;\n  }\n  .ant-modal-close-x {\n    color: white;\n  }\n  .ant-list-item {\n    border-bottom: none;\n    padding: 4px 20px;\n    height: 56px;\n    &:hover {\n      background-color: rgb(60, 58, 75);\n      cursor: pointer;\n    }\n    &.selected {\n      background-color: rgb(60, 58, 75);\n    }\n  }\n  .currency-item {\n    width: 100%;\n    .info {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n    .icon {\n      width: 24px;\n      height: 24px;\n      margin-right: 10px;\n    }\n    .symbol-name {\n      display: flex;\n      flex-direction: column;\n      .symbol {\n        font-size: 16px;\n        font-weight: 600;\n        line-height: 1.5;\n      }\n      .name {\n        font-size: 14px;\n        line-height: 1.5;\n      }\n    }\n  }\n"]))),ht=ke.a.div(rt||(rt=Object(fe.a)(["\n  display: flex;\n  justify-content: space-between;\n  .ant-typography {\n    color: white;\n    font-size: 16px;\n    font-weight: 400;\n    line-height: 1.5;\n  }\n  .ckb-logo {\n    height: 24px;\n    width: 24px;\n    margin-right: 8px;\n  }\n  .max-button {\n    height: 32px;\n    padding: 0px 16px;\n    background-color: transparent;\n    color: rgb(255, 67, 66);\n    font-weight: 600;\n  }\n"])));function ut(e){let{autoFocus:t,disableInput:n,value:i,onUserInput:s,label:r,onSelectedChange:c}=e;const[o,l]=Object(a.useState)(""),[d,p]=Object(a.useState)(!1),[h,u]=Object(a.useState)([]),[b,g]=Object(a.useState)([]),[x,f]=Object(a.useState)(),[w,y]=Object(a.useState)(),m=Oe(),[j,_]=Object(a.useState)(!1);Object(a.useEffect)((()=>{(async()=>{if(m){const e=m.getBuiltinErc20List();u(e);const t=e.map((e=>e.address)),n=await m.getErc20Balances({addresses:t});g(n.balances)}})()}),[m]),Object(a.useEffect)((()=>{p(!(!x||i===o&&""!==i))}),[i,o,x]),Object(a.useEffect)((()=>{if(b&&b.length&&void 0!==w&&x){const e=b[w],t=Be(BigInt(e),x.decimals);l(t)}}),[w,b,x]);return Object(be.jsxs)(lt,{children:[Object(be.jsxs)(ht,{className:"first-row",children:[Object(be.jsx)(je.a.Text,{children:r}),Object(be.jsx)(je.a.Text,{children:o||""})]}),Object(be.jsxs)(ht,{className:"input-wrapper",children:[Object(be.jsx)(Re,{autoFocus:t,disabled:n,className:"token-amount-input",value:i,onUserInput:e=>{s(e)}}),d&&Object(be.jsx)("div",{className:"max-button",onClick:()=>{s(o),p(!1)},children:"MAX"}),Object(be.jsxs)("div",{className:"currency-wrapper",onClick:()=>{_(!0)},children:[x?Object(be.jsxs)("div",{className:"currency-icon",children:[Object(be.jsx)("img",{className:"ckb-logo",src:x.tokenURI,alt:""}),Object(be.jsx)(je.a.Text,{children:x.symbol})]}):Object(be.jsx)(ot,{children:"Select a currency "}),Object(be.jsx)(De.a,{})]})]}),Object(be.jsx)(pt,{title:"Select a Token",visible:j,onOk:()=>{_(!1)},onCancel:()=>{_(!1)},footer:null,children:Object(be.jsx)(dt,{className:"token-list",children:Object(be.jsx)(Me.b,{dataSource:h,renderItem:(e,t)=>Object(be.jsx)(Me.b.Item,{className:e.address===(null===x||void 0===x?void 0:x.address)?"selected":"",onClick:()=>((e,t)=>{f(t),c(t),_(!1),p(!0),s(""),y(e)})(t,e),children:Object(be.jsxs)(tt,{className:"currency-item",children:[Object(be.jsxs)("div",{className:"info",children:[Object(be.jsx)("img",{className:"icon",src:e.tokenURI,alt:""}),Object(be.jsxs)("div",{className:"symbol-name",children:[Object(be.jsx)(ot,{className:"symbol",children:e.symbol}),Object(be.jsx)(ot,{className:"name",children:e.name})]})]}),Object(be.jsx)("div",{children:b.length?Be(BigInt(b[t]),e.decimals):""})]})})})})})]})}var bt,gt=n(398),xt=n(205),ft=n(827);const wt=ke.a.div(bt||(bt=Object(fe.a)(["\n  color: #fff;\n  .text-pair {\n    display: flex;\n    justify-content: space-between;\n  }\n"])));function yt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;return e.substring(0,t)+"..."+e.substring(e.length-n)}const mt=()=>{const e=Oe(),t=Object(a.useMemo)((()=>{if(e)return e.provider.getL2Address()}),[e]);return e&&t?Object(be.jsx)(xt.a,{title:Object(be.jsxs)(wt,{children:[Object(be.jsxs)("div",{className:"address-content",children:[Object(be.jsx)("label",{htmlFor:"",children:"ETH ADDRESS"}),Object(be.jsxs)(ft.a.Group,{compact:!0,children:[Object(be.jsx)(ft.a,{style:{width:"calc(100% - 33px)"},value:e.provider.getL2Address()}),Object(be.jsx)(xt.a,{title:"copy git url",children:Object(be.jsx)(Ae.a,{icon:Object(be.jsx)(gt.a,{})})})]})]}),Object(be.jsxs)("div",{className:"address-content",children:[Object(be.jsx)("label",{htmlFor:"",children:"L1 WALLET ADDRESS"}),Object(be.jsxs)(ft.a.Group,{compact:!0,children:[Object(be.jsx)(ft.a,{style:{width:"calc(100% - 33px)"},value:e.provider.getL1Address()}),Object(be.jsx)(xt.a,{title:"copy git url",children:Object(be.jsx)(Ae.a,{icon:Object(be.jsx)(gt.a,{})})})]})]})]}),children:yt(t)}):null};var jt;const _t=Object(ke.a)(Ae.a)(jt||(jt=Object(fe.a)(["\n  &.ant-btn-primary {\n    background: rgb(60, 58, 75);\n    border: none;\n  }\n"]))),vt=()=>{const e=Oe();return Object(be.jsx)(_t,{type:"primary",onClick:function(){e||d()().then((e=>{e.request({method:"eth_requestAccounts"})}))},children:e?Object(be.jsx)(mt,{}):"Connect"})};var At;const kt=ke.a.div(At||(At=Object(fe.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  width: 100%;\n  padding: 16px;\n  background: radial-gradient(89.56% 89.56% at 50.04% 10.44%, rgb(60, 58, 75) 0%, rgb(28, 27, 37) 92.56%);\n  margin-bottom: 20px;\n  color: white;\n  .address:hover {\n    cursor: pointer;\n  }\n"])));var Ot,zt=()=>Object(be.jsxs)(kt,{children:[Object(be.jsx)("div",{className:"icon"}),Object(be.jsx)("div",{className:"title",children:"Withdrawal"}),Object(be.jsx)("div",{className:"address",children:Object(be.jsx)(vt,{})})]});const Bt=ke.a.div(Ot||(Ot=Object(fe.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n  min-height: calc(100vh);\n  background: radial-gradient(89.56% 89.56% at 50.04% 10.44%, rgb(60, 58, 75) 0%, rgb(28, 27, 37) 92.56%);\n"])));var Ct,St,It,Ut,Nt,Rt=e=>{let{children:t,...n}=e;return Object(be.jsxs)(Bt,{...n,children:[Object(be.jsx)(zt,{}),t]})};const{Text:Et}=je.a,Lt=ke.a.div(Ct||(Ct=Object(fe.a)(["\n  width: 436px;\n  background: rgb(39, 37, 52);\n  border-radius: 24px;\n  color: white;\n"]))),Tt=ke.a.div(St||(St=Object(fe.a)(["\n  display: flex;\n  justify-content: space-between;\n  padding: 24px;\n  align-items: center;\n  a,\n  .ant-typography {\n    color: white;\n  }\n"]))),Mt=ke.a.div(It||(It=Object(fe.a)(["\n  padding: 24px;\n  grid-auto-rows: auto;\n  row-gap: 8px;\n  .icon {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    padding-top: 8px;\n    padding-bottom: 8px;\n  }\n"]))),Wt=ke.a.div(Ut||(Ut=Object(fe.a)(["\n  margin-top: 20px;\n  display: flex;\n  justify-content: center;\n  .submit-button {\n    align-items: center;\n    border: 0px;\n    border-radius: 16px;\n    box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n    cursor: pointer;\n    display: inline-flex;\n    font-family: inherit;\n    font-size: 16px;\n    font-weight: 600;\n    -webkit-box-pack: center;\n    justify-content: center;\n    letter-spacing: 0.03em;\n    line-height: 1;\n    opacity: 1;\n    outline: 0px;\n    transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n    height: 48px;\n    padding: 0px 24px;\n    background-color: rgb(255, 67, 66);\n    color: white;\n    width: 100%;\n    &:disabled {\n      background-color: rgb(60, 55, 66);\n      border-color: rgb(60, 55, 66);\n      box-shadow: none;\n      color: rgb(104, 102, 123);\n      cursor: not-allowed;\n    }\n  }\n  button:hover {\n    cursor: pointer;\n  }\n"]))),Dt=Object(ke.a)(_e.a)(Nt||(Nt=Object(fe.a)(["\n  color: white;\n  .ant-modal-content {\n    border-radius: 32px;\n    background: rgb(39, 37, 52);\n    box-shadow: rgb(14 14 44 / 10%) 0px 20px 36px -8px, rgb(0 0 0 / 5%) 0px 1px 1px;\n    border: 1px solid rgb(60, 58, 75);\n    color: white;\n  }\n  .ant-modal-header {\n    background: rgb(39, 37, 52);\n    border: 1px solid rgb(60, 58, 75);\n    border-top-left-radius: 32px;\n    border-top-right-radius: 32px;\n    padding: 12px 24px;\n    height: 73px;\n    display: flex;\n    align-items: center;\n  }\n  .ant-modal-title,\n  .ant-list-item {\n    color: white;\n  }\n  .ant-modal-body {\n    padding: 24px;\n  }\n  .ant-modal-close-x {\n    color: white;\n  }\n  .ant-typography {\n    color: white;\n    justify-content: space-between;\n  }\n  .text-pair {\n    padding-top: 5px;\n    display: flex;\n    justify-content: space-between;\n    font-size: 24px;\n  }\n  .tips {\n    margin: 24px 0;\n  }\n"])));function Pt(){const[e,t]=Object(a.useState)(""),[n,i]=Object(a.useState)(""),[s,r]=Object(a.useState)(!1),[o,l]=Object(a.useState)(!1),[d,p]=Object(a.useState)(!0),[h,u]=Object(a.useState)(),b=Oe();Object(a.useEffect)((()=>{Number(e)>=400?p(!1):p(!0)}),[e]);return Object(be.jsxs)(Rt,{children:[Object(be.jsxs)(Lt,{children:[Object(be.jsxs)(Tt,{className:"header",children:[Object(be.jsx)(c.b,{to:"/",children:Object(be.jsx)(we.a,{})}),Object(be.jsx)(Et,{children:"Request Withdrawal"}),Object(be.jsx)(ye.a,{})]}),Object(be.jsxs)(Mt,{className:"main",children:[Object(be.jsx)(Te,{value:e,onUserInput:t,label:"Withdraw"}),Object(be.jsx)("div",{className:"icon",children:Object(be.jsx)(me.a,{})}),Object(be.jsx)(ut,{value:n,onUserInput:i,label:"sUDT(optional)",onSelectedChange:u}),Object(be.jsx)(Wt,{children:Object(be.jsx)(Ae.a,{className:"submit-button",disabled:d,onClick:()=>{r(!0)},children:"Request Withdrawal"})})]}),Object(be.jsx)("div",{className:"footer"})]}),Object(be.jsxs)(Dt,{title:"Confirm Request",visible:s,onCancel:()=>{r(!1)},footer:null,children:[Object(be.jsxs)("div",{className:"text-pair",children:[Object(be.jsx)(Et,{children:"Block wait"}),Object(be.jsx)(Et,{children:"10000"})]}),Object(be.jsxs)("div",{className:"text-pair",children:[Object(be.jsx)(Et,{children:"Estimated time"}),Object(be.jsx)(Et,{children:"5 days"})]}),Object(be.jsx)("div",{className:"tips",children:"Layer 2 assets will be locked in Withdrawal Request, available to withdraw to Layer 1 after maturity. Request Withdrawal"}),Object(be.jsx)(Wt,{children:Object(be.jsx)(Ae.a,{className:"submit-button",loading:o,onClick:()=>{l(!0);const t=BigInt(e)*BigInt(Math.pow(10,8));let a,i="0x0",s="0x0000000000000000000000000000000000000000000000000000000000000000";if(h&&(i="0x"+BigInt(Number(n)*Math.pow(10,h.decimals)).toString(16),s=h.sudt_script_hash),b){try{a=b.withdrawWithEvent({capacity:"0x"+t.toString(16),amount:i,sudt_script_hash:s})}catch(a){return void console.log("withdrawal error:",a)}a.on("sent",(e=>{r(!1),ve.a.info({message:"Withdrawal Tx(".concat(e,") has sent")}),l(!1)})),a.on("pending",(e=>{console.log("pending triggerd",e)})),a.on("success",(e=>{r(!1),ve.a.success({message:"Withdrawal Tx(".concat(e,") is successful")})})),a.on("error",(e=>{l(!1),ve.a.error({message:e instanceof Error?e.message:JSON.stringify(e)})}))}},children:"Request Withdrawal"})})]})]})}var Gt,qt;const Ft=ke.a.div(Gt||(Gt=Object(fe.a)(["\n  width: 436px;\n  background: rgb(39, 37, 52);\n  border-radius: 24px;\n  color: white;\n  .request-withdrawal {\n    padding: 24px;\n  }\n  .title {\n    font-size: 20px;\n    font-weight: 600;\n    line-height: 1.1;\n    margin-bottom: 8px;\n  }\n  .description {\n    font-weight: 400;\n    line-height: 1.5;\n    font-size: 14px;\n  }\n  .button-container {\n    margin-top: 16px;\n  }\n  .request-button {\n    -webkit-box-align: center;\n    align-items: center;\n    border: 0px;\n    border-radius: 16px;\n    box-shadow: rgb(14 14 44 / 40%) 0px -1px 0px 0px inset;\n    cursor: pointer;\n    display: inline-flex;\n    font-family: inherit;\n    font-size: 16px;\n    font-weight: 600;\n    -webkit-box-pack: center;\n    justify-content: center;\n    letter-spacing: 0.03em;\n    line-height: 1;\n    opacity: 1;\n    outline: 0px;\n    transition: background-color 0.2s ease 0s, opacity 0.2s ease 0s;\n    height: 48px;\n    padding: 0px 24px;\n    background-color: rgb(255, 67, 66);\n    color: white;\n  }\n"]))),Ht=ke.a.div(qt||(qt=Object(fe.a)(["\n  > .header {\n    -webkit-box-align: center;\n    align-items: center;\n    -webkit-box-pack: justify;\n    justify-content: space-between;\n    padding: 24px;\n    width: 100%;\n    border-bottom: 1px solid rgb(60, 58, 75);\n    border-top: 1px solid rgb(60, 58, 75);\n    font-size: 16px;\n    font-weight: 600;\n    line-height: 1.5;\n  }\n  .list {\n    max-height: calc(100vh - 400px);\n    overflow-y: auto;\n    background-color: rgb(16, 12, 24);\n    padding: 24px;\n    border-bottom-left-radius: 24px;\n    border-bottom-right-radius: 24px;\n    & > div {\n      margin-bottom: 16px;\n    }\n  }\n"])));var Qt=()=>{const[e,t]=Object(a.useState)([]),n=Oe(),i=function(){const[e,t]=Object(a.useState)((()=>Date.now()));return Object(a.useEffect)((()=>{const e=()=>{t(Date.now()),setTimeout(e,1e3)};setTimeout(e,1e3)}),[]),e}();return Object(a.useEffect)((()=>{(async()=>{if(n){const e=await(null===n||void 0===n?void 0:n.listWithdraw());t(e)}})()}),[n]),Object(be.jsx)(Rt,{children:Object(be.jsxs)(Ft,{className:"content",children:[Object(be.jsxs)("div",{className:"request-withdrawal",children:[Object(be.jsx)("div",{className:"title",children:"Withdrawal"}),Object(be.jsx)("div",{className:"description",children:"To withdraw assets back to Layer 1, you need to have CKB balance in your L1 Wallet Address"}),Object(be.jsx)("div",{className:"button-container",children:Object(be.jsx)(c.b,{to:"/request-withdrawal",className:"request-button",children:"Request Withdrawal"})})]}),Object(be.jsxs)(Ht,{className:"withdrawal-request",children:[Object(be.jsx)("div",{className:"header",children:"Your Withdrawal Requests"}),Object(be.jsx)("div",{className:"list",children:e.map(((e,t)=>Object(a.createElement)(ct,{now:i,...e,key:t})))})]})]})})};var Jt=function(){return Object(be.jsx)(xe,{children:Object(be.jsx)(c.a,{children:Object(be.jsxs)(o.c,{children:[Object(be.jsx)(o.a,{path:"/",element:Object(be.jsx)(Qt,{})}),Object(be.jsx)(o.a,{path:"/request-withdrawal",element:Object(be.jsx)(Pt,{})})]})})})};var Kt=e=>{e&&e instanceof Function&&import("web-vitals").then((t=>{let{getCLS:n,getFID:a,getFCP:i,getLCP:s,getTTFB:r}=t;n(e),a(e),i(e),s(e),r(e)}))};n(819);p.config.initializeConfig(p.config.predefined.AGGRON4),r.a.render(Object(be.jsx)(i.a.StrictMode,{children:Object(be.jsx)(Jt,{})}),document.getElementById("root")),Kt()}},[[820,1,2]]]);
//# sourceMappingURL=main.bbdde19b.chunk.js.map